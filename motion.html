<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Eyeplayer : Control stuff with your webcam" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <style>
      div#videoContainer {
        height: 480px;
        max-width: 1024px;
        position: relative;
      }
      canvas#overlay {
        width: 100%;
        position: absolute;
        transform: rotateY(180deg);
        -webkit-transform:rotateY(180deg); /* Safari and Chrome */
        -moz-transform:rotateY(180deg);
      }
      video {
        width: 100%;
        position: absolute;
      }
    </style>

    <title>Eyeplayer</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/sidekickstudios/eyeplayer">View on GitHub</a>

          <h1 id="project_title"><a href="./">Eyeplayer</a></h1>
          <h2 id="project_tagline">Control stuff with your webcam using Javascript</h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>Motion Detection</h2>

        <div id="videoContainer">
          <video id="inputVideo" autoplay></video>
          <canvas id="overlay"></canvas>
        </div>

        <h3>About this demonstration</h3>
        <p>This is an example of using a webcam to detect a user's motion on a region at the top of the screen.</p>
        <p>It uses the following approach:</p>
        <ul>
          <li>we blend the current frame with the previous frame to calculate what changed in between - this is based on the work by <a href="http://www.soundstep.com/blog/experiments/jsdetection/">Romuald Quantin</a>.</li>
          <li>we take the top fifth of the video stream, split it into eight regions and if on average more than 10% of pixels have changed we can trigger some action for that region.</li>
        </ul>
        <p>View the <a href="https://github.com/sidekickstudios/eyeplayer/blob/master/app/motionPlayer.js">motionPlayer.js</a> source on Github to see how the code works.</p>

        <h3>Usage example</h3>
        <pre><code>&lt;div id="videoContainer"&gt;
  &lt;video id="inputVideo" autoplay&gt;&lt;/video&gt;
  &lt;canvas id="overlay"&gt;&lt;/canvas&gt;
&lt;/div&gt;

&lt;script data-main="javascripts/eyePlayer.min.js" src="javascripts/require.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
require(['motionPlayer'], function(motionPlayer) {
  var scale = 1/3;
  var video = document.getElementById('inputVideo');
  var canvas = document.getElementById('overlay');
  var motionplayer = new motionPlayer({
    scale: scale, // scale the webcam image down to improve performance
    filter: function(image) { // add a filter to the processed image, e.g. make it semi transparent
      data = image.data;
      for (var i=0; i&lt;data.length; i+=4) {
        data[i+3] = 50;
      }
    }
  });
  var ctx = canvas.getContext('2d');

  motionplayer.init(video, canvas);
  motionplayer.start();

  document.addEventListener('motionEvent', function(event) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    // draw the motion image
    ctx.drawImage(event.image, 0, canvas.height-(canvas.height*scale), canvas.width*scale, canvas.height*scale);

    for (var i=0; i&lt;event.regions.length; i++) {
      if (event.regions[i] > 0) {
       // SOMETHING HAPPENED IN THIS REGION
      }
    }
  });
});
&lt;/script&gt;</code></pre>

        <p>View source of this page to see a more complete example.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <section id="downloads">
          <p><strong>Download the code</strong></p>
          <a class="zip_download_link" href="https://github.com/sidekickstudios/eyeplayer/zipball/master">Download this project as a .zip file</a>
          <a class="tar_download_link" href="https://github.com/sidekickstudios/eyeplayer/tarball/master">Download this project as a tar.gz file</a>
        </section>
        <p class="copyright">Eyeplayer maintained by <a href="https://github.com/sidekickstudios">sidekickstudios</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    <script data-main="javascripts/motionPlayer.min.js" src="javascripts/require.js"></script>
    <script type="text/javascript">
      require(['motionPlayer'], function(motionPlayer) {
        var scale = 1/3;
        var video = document.getElementById('inputVideo');
        var canvas = document.getElementById('overlay');
        var motionplayer = new motionPlayer({
          debug: true,
          scale: scale,
          filter: function(image) {
            data = image.data;
            for (var i=0; i<data.length; i+=4) {
              data[i+3] = 50;
            }
          }
        });
        var ctx = canvas.getContext('2d');

        motionplayer.init(video, canvas);
        motionplayer.start();

        document.addEventListener('motionEvent', function(event) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          ctx.drawImage(event.image, 0, canvas.height-(canvas.height*scale), canvas.width*scale, canvas.height*scale);

          var w = canvas.width/8;
          ctx.strokeStyle = "rgba(255,255,255,1)";
          ctx.strokeRect(3, 3, canvas.width-6, w-3);

          for (var i=0; i<event.regions.length; i++) {
            if (event.regions[i] > 0) {
              ctx.fillStyle = "rgba(255,255,255," + (event.regions[i]/100) + ")";
              ctx.fillRect(i*w, 0, w, w);

              ctx.fillStyle = "rgba(0,0,0,1)";
              ctx.save();
              ctx.translate(i*w, 10);
              ctx.scale(-1,1);
              ctx.font="10px Georgia";
              ctx.fillText(Math.floor(event.regions[i]), w/2, w/2);
              ctx.restore();

            }
          }
        });
      });
     </script>
  </body>
</html>
